<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matchs en direct ‚Äî MHD Pronos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#0b0e14; --panel:#121826; --muted:#a3aed0; --violet:#7c5cff; --green:#16c784; --red:#ff4d4d; --blue:#3b82f6;
    }
    body{background: radial-gradient(1200px 600px at 20% 0%, rgba(124,92,255,.15), transparent 40%), var(--bg); color:#fff;}
    .glass{background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.08); box-shadow: 0 10px 40px rgba(0,0,0,.35);}
    .pill{border:1px solid rgba(255,255,255,.15); background: rgba(255,255,255,.06);}
    .pill.active{border-color:var(--violet); box-shadow: 0 0 0 3px rgba(124,92,255,.25) inset; color:#fff;}
    .tab-btn{border:1px solid rgba(255,255,255,.14); background: rgba(255,255,255,.05); transition:.2s}
    .tab-btn.active{background: var(--violet); border-color:transparent;}
    .live-dot{width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 0 6px rgba(255,77,77,.15)}
    .table-wrap{overflow-x:auto}
    table{min-width: 760px; border-collapse:separate;border-spacing:0}
    thead th{position:sticky; top:0; background:rgba(255,255,255,.05); backdrop-filter: blur(6px);}
    tr+tr td{border-top:1px dashed rgba(255,255,255,.08)}
    .badge{font-size:.75rem; padding:.2rem .5rem; border-radius:999px;}
    .badge.live{background:rgba(255,77,77,.15); color:#ffb3b3; border:1px solid rgba(255,77,77,.35)}
    .badge.soon{background:rgba(60,167,255,.12); color:#b9dcff; border:1px solid rgba(60,167,255,.35)}
    .badge.done{background:rgba(22,199,132,.12); color:#9bf0c9; border:1px solid rgba(22,199,132,.35)}
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:50}
    .modal.open{display:flex}
  </style>
</head>
<body class="min-h-screen">
  <!-- Header minimal coh√©rent -->
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="logo.JPG" alt="MHD" class="w-10 h-10 rounded-full object-cover ring-2 ring-white/10">
        <div>
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Matchs en direct</h1>
          <p class="text-sm text-white/60 -mt-0.5">LDC, Premier League, LaLiga, Bundesliga, Ligue 1 ‚Äì mis √† jour en temps r√©el.</p>
        </div>
      </div>
      <nav class="hidden md:flex items-center gap-2">
        <a href="home.html" class="pill px-4 py-2 rounded-xl hover:opacity-90">Accueil</a>
        <a href="plan abonnement.html" class="pill px-4 py-2 rounded-xl hover:opacity-90">Abonnements</a>
        <a href="notifications.html" class="pill px-4 py-2 rounded-xl hover:opacity-90">Notifications</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-24">
    <!-- Onglets -->
    <div class="glass rounded-2xl p-3 md:p-4 mb-4">
      <div class="flex flex-wrap items-center gap-2">
        <button data-tab="live" class="tab-btn active px-4 py-2 rounded-xl font-semibold">En cours ‚ö°</button>
        <button data-tab="upcoming" class="tab-btn px-4 py-2 rounded-xl font-semibold">√Ä venir üïí</button>
        <button data-tab="finished" class="tab-btn px-4 py-2 rounded-xl font-semibold">Termin√©s üî¥</button>
        <div class="ml-auto text-xs text-white/60">MAJ auto <span id="refreshIn">20s</span></div>
      </div>
    </div>

    <!-- Filtres ligues -->
    <div class="glass rounded-2xl p-3 md:p-4 mb-6">
      <div class="flex flex-wrap gap-2">
        <!-- data-league correspond aux IDs API-Football -->
        <button class="pill active px-3 py-1.5 rounded-full text-sm" data-league="ALL">Tous</button>
        <button class="pill px-3 py-1.5 rounded-full text-sm" data-league="2">Ligue des Champions</button>
        <button class="pill px-3 py-1.5 rounded-full text-sm" data-league="39">Premier League</button>
        <button class="pill px-3 py-1.5 rounded-full text-sm" data-league="140">LaLiga</button>
        <button class="pill px-3 py-1.5 rounded-full text-sm" data-league="78">Bundesliga</button>
        <button class="pill px-3 py-1.5 rounded-full text-sm" data-league="61">Ligue 1</button>
      </div>
    </div>

    <!-- Conteneurs par onglet -->
    <section id="tab-live" class="space-y-8"></section>
    <section id="tab-upcoming" class="space-y-8 hidden"></section>
    <section id="tab-finished" class="space-y-8 hidden"></section>
  </main>

  <!-- Modal d√©tail -->
  <div id="matchModal" class="modal">
    <div class="glass rounded-2xl p-5 w-[95%] max-w-2xl">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 id="mTitle" class="text-xl font-bold"></h3>
          <p id="mComp" class="text-sm text-white/60"></p>
        </div>
        <button id="mClose" class="pill px-3 py-1.5 rounded-lg">Fermer</button>
      </div>
      <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="glass rounded-xl p-4">
          <div id="mScore" class="text-3xl font-extrabold"></div>
          <div id="mStatus" class="text-xs text-white/60 mt-1"></div>
        </div>
        <div class="glass rounded-xl p-4 text-sm">
          <div id="mExtra" class="space-y-1"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
/* =========================
   CONFIG SPORTMONKS v3
   ========================= */
const API_TOKEN = "KAYxTdFviUVgBb9yBHOMIZVTGrwJK5RxMgO6rCjzHB6Av9YsKsoJDEgHcxWn"; // <-- remplace par ta cl√© SportMonks (sans espaces)
const API_BASE  = "https://api.sportmonks.com/v3/football";

/* Ligues gard√©es : on filtre par nom pour √©viter les IDs */
const LIGUE_NOMS = [
  "Premier League",
  "La Liga",
  "Bundesliga",
  "Ligue 1",
  "UEFA Champions League"
];

/* S√©lecteurs (adapte si tes IDs/classes sont diff√©rents) */
const tabLiveBtn   = document.querySelector('[data-tab="live"]');
const tabNextBtn   = document.querySelector('[data-tab="next"]');
const tabDoneBtn   = document.querySelector('[data-tab="done"]');
const container    = document.getElementById("matchesContainer") || document.body;

/* Petites aides de date (UTC) */
const today    = new Date();
const ymd      = d => d.toISOString().slice(0,10);
const dtToday  = ymd(today);
const dtTomorrow = ymd(new Date(+today + 24*3600*1000));
const dtYesterday = ymd(new Date(+today - 24*3600*1000));

/* Appel JSON + gestion d‚Äôerreurs lisibles */
async function getJSON(url){
  try {
    const res = await fetch(url);
    if(!res.ok){
      const text = await res.text();
      throw new Error(`HTTP ${res.status} ‚Äì ${text}`);
    }
    return await res.json();
  } catch(err){
    console.error("Erreur API:", err);
    showMessage("‚ùå Erreur de chargement : " + err.message);
    return null;
  }
}

/* Rend un petit message dans la zone d‚Äôaffichage */
function showMessage(msg){
  container.innerHTML = `
    <div class="rounded-xl bg-gray-800/60 border border-gray-700 px-4 py-5 text-sm text-gray-300">
      ${msg}
    </div>`;
}

/* Rendu d‚Äôun match (carte simple) */
function renderMatch(m){
  const league = m.league?.name ?? "Comp√©tition";
  const status = m.state?.short_name ?? m.time?.status ?? "";
  const home   = m.participants?.find(p=>p.meta?.location==="home")?.name ?? m.home_name ?? "Home";
  const away   = m.participants?.find(p=>p.meta?.location==="away")?.name ?? m.away_name ?? "Away";
  const hs     = m.scores?.find(s=>s.description==="CURRENT")?.score?.home ?? m.home_score ?? "-";
  const as     = m.scores?.find(s=>s.description==="CURRENT")?.score?.away ?? m.away_score ?? "-";
  const start  = m.starting_at ? new Date(m.starting_at).toLocaleString() : (m.time?.starting_at ?? "");

  return `
    <div class="match-card rounded-xl bg-[#111827] border border-gray-700 p-4 mb-3">
      <div class="flex items-center justify-between mb-2">
        <div class="text-xs text-gray-400">${league}</div>
        <div class="text-xs px-2 py-1 rounded-full bg-gray-700 text-gray-200">${status}</div>
      </div>
      <div class="flex items-center justify-between">
        <div class="font-medium">${home}</div>
        <div class="text-lg font-bold tabular-nums">${hs} : ${as}</div>
        <div class="font-medium text-right">${away}</div>
      </div>
      <div class="text-xs text-gray-400 mt-2">${start}</div>
    </div>`;
}

/* Rendu d‚Äôune liste de matches */
function renderList(list){
  if(!list || list.length===0){
    showMessage("Aucun match √† afficher pour cet onglet.");
    return;
  }
  container.innerHTML = list.map(renderMatch).join("");
}

/* Filtre par ligues souhait√©es (par nom) */
function keepWantedLeagues(rows){
  return (rows||[]).filter(r => {
    const name = r.league?.name || "";
    return LIGUE_NOMS.some(L => name.toLowerCase().includes(L.toLowerCase()));
  });
}

/* ======= CHARGEMENTS ======= */

/* LIVE */
async function loadLive(){
  container.innerHTML = "";
  // include pour avoir league/participants/scores/states
  const url = `${API_BASE}/livescores?api_token=${API_TOKEN}&include=league;participants;state;scores`;
  const data = await getJSON(url);
  if(!data || !data.data){ return; }

  const rows = keepWantedLeagues(data.data);
  renderList(rows);
}

/* A VENIR (aujourd‚Äôhui + demain) */
async function loadNext(){
  container.innerHTML = "";
  const include = "league;participants;state";
  const u1 = `${API_BASE}/fixtures/date/${dtToday}?api_token=${API_TOKEN}&include=${include}`;
  const u2 = `${API_BASE}/fixtures/date/${dtTomorrow}?api_token=${API_TOKEN}&include=${include}`;

  const [d1,d2] = await Promise.all([getJSON(u1), getJSON(u2)]);
  const rows = keepWantedLeagues([...(d1?.data||[]), ...(d2?.data||[])]);
  renderList(rows);
}

/* TERMIN√âS (hier) */
async function loadDone(){
  container.innerHTML = "";
  const url = `${API_BASE}/fixtures/date/${dtYesterday}?api_token=${API_TOKEN}&include=league;participants;state;scores`;
  const data = await getJSON(url);
  const rows = keepWantedLeagues(data?.data||[]);
  renderList(rows);
}

/* Onglets */
function activateTab(which){
  document.querySelectorAll('[data-tab]').forEach(b=>b.classList.remove("is-active"));
  document.querySelector(`[data-tab="${which}"]`)?.classList.add("is-active");
}

/* Hooks UI (si tu as les boutons) */
tabLiveBtn?.addEventListener("click", ()=>{ activateTab("live"); loadLive(); });
tabNextBtn?.addEventListener("click", ()=>{ activateTab("next"); loadNext(); });
tabDoneBtn?.addEventListener("click", ()=>{ activateTab("done"); loadDone(); });

/* D√©marrage par d√©faut */
activateTab("live");
loadLive();

/* Rafra√Æchit le LIVE toutes les 30s (optionnel) */
setInterval(()=>{
  if(document.querySelector('[data-tab].is-active')?.dataset.tab === "live"){
    loadLive();
  }
}, 30000);
</script>

</body>
</html>
